This whole thing needs to be rewritten in a more coherent manner. It's a mess.
